<!-- Modern Subscribe Popup Modal (simplified for MailerLite embed.) -->
<div id="subscribe-popup" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm">
  <div class="relative max-w-lg w-full mx-4 transform transition-all duration-300 scale-95 opacity-0" id="popup-content">
    <!-- Close button -->
    <button onclick="closeSubscribePopup()" class="absolute -top-3 -right-3 z-10 bg-neutral-800 hover:bg-neutral-700 rounded-full p-2 text-neutral-300 hover:text-white shadow-xl transition-all duration-200">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
    
    <!-- Popup content with MailerLite container -->
    <div class="bg-gradient-to-br from-orange-500 to-red-600 rounded-2xl shadow-2xl overflow-hidden border-2 border-orange-400">
      <div class="p-8">
        <!-- Header -->
        <div class="text-center mb-6">
          <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
            </svg>
          </div>
          <h3 class="text-2xl font-bold text-white mb-2">Stay Updated!</h3>
          <p class="text-orange-100 text-sm">Get the latest insights on AI, technology, and business delivered to your inbox.</p>
        </div>
        
        <!-- MailerLite form will be injected here -->
        <div id="popup-form-container"></div>
        
        <!-- Footer -->
        <div class="mt-6 text-center">
          <p class="text-orange-200 text-xs">No spam, unsubscribe anytime. Privacy policy compliant.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Mobile Menu Toggle -->
<div class="fixed bottom-4 right-4 z-50 lg:hidden">
  <button id="mobile-menu-toggle" class="rounded-full bg-orange-500 p-3 text-white shadow-lg hover:bg-orange-600">
    â˜°
  </button>
</div>

<!-- Required JavaScript Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="/js/mobile-menu.js?v={{ now.Unix }}"></script>

<!-- Subscribe Popup JavaScript -->
<script>
  // Popup state management
  let popupShown = false;
  let timeoutId = null;

  function openSubscribePopup() {
    if (popupShown) return;
    const popup = document.getElementById('subscribe-popup');
    const content = document.getElementById('popup-content');
    
    popup.classList.remove('hidden');
    popup.classList.add('flex');
    document.body.style.overflow = 'hidden';
    
    // Animate in
    setTimeout(() => {
      content.classList.remove('scale-95', 'opacity-0');
      content.classList.add('scale-100', 'opacity-100');
    }, 10);
    
    // Inject MailerLite form if not already loaded
    try {
      const container = document.getElementById('popup-form-container');
      if (container && !container.dataset.loaded) {
        ml('form', '169453382423020905', 'popup-form-container');
        container.dataset.loaded = 'true';
      }
    } catch (err) {
      console.error('Failed to load MailerLite form:', err);
    }
    
    popupShown = true;
    localStorage.setItem('subscribePopupShown', 'true');
    localStorage.setItem('subscribePopupTime', Date.now().toString());
  }

  function closeSubscribePopup() {
    const popup = document.getElementById('subscribe-popup');
    const content = document.getElementById('popup-content');
    
    // Animate out
    content.classList.remove('scale-100', 'opacity-100');
    content.classList.add('scale-95', 'opacity-0');
    
    setTimeout(() => {
      popup.classList.add('hidden');
      popup.classList.remove('flex');
      document.body.style.overflow = 'auto';
    }, 300);
  }

  function shouldShowPopup() {
    // Don't show if already subscribed or dismissed recently
    const lastShown = localStorage.getItem('subscribePopupTime');
    const subscribed = localStorage.getItem('subscribed');
    if (subscribed === 'true') return false;
    if (lastShown) {
      const timeDiff = Date.now() - parseInt(lastShown);
      const hoursDiff = timeDiff / (1000 * 60 * 60);
      if (hoursDiff < 24) return false;
    }
    return true;
  }

  function initPopupTriggers() {
    if (!shouldShowPopup()) return;
    const currentPath = window.location.pathname;
    // Trigger 1: Homepage - show after 3 seconds
    if (currentPath === '/' || currentPath === '/index.html') {
      timeoutId = setTimeout(() => {
        openSubscribePopup();
      }, 3000);
    }
    // Trigger 2: 2-minute timer on any page
    setTimeout(() => {
      if (!popupShown && shouldShowPopup()) {
        openSubscribePopup();
      }
    }, 120000);
    // Trigger 3: Exit intent (mouse leaving viewport)
    document.addEventListener('mouseleave', function(e) {
      if (e.clientY <= 0 && !popupShown && shouldShowPopup()) {
        openSubscribePopup();
      }
    });
    // Trigger 4: Scroll to bottom of post
    if (currentPath.includes('/posts/')) {
      let scrollTriggered = false;
      window.addEventListener('scroll', function() {
        if (scrollTriggered || popupShown) return;
        const scrollPercent = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
        if (scrollPercent > 80) {
          scrollTriggered = true;
          setTimeout(() => {
            if (!popupShown && shouldShowPopup()) {
              openSubscribePopup();
            }
          }, 2000);
        }
      });
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    // Close popup when clicking outside or pressing Escape
    document.getElementById('subscribe-popup').addEventListener('click', function(e) {
      if (e.target === this) { closeSubscribePopup(); }
    });
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') { closeSubscribePopup(); }
    });
    initPopupTriggers();
  });
  
  // Expose function to manually trigger popup from other parts of the site
  window.triggerSubscribePopup = function() {
    if (timeoutId) clearTimeout(timeoutId);
    openSubscribePopup();
  };
</script>

<!-- Botpress Webchat Embed (unchanged) -->
<script src="https://cdn.botpress.cloud/webchat/v3.3/inject.js"></script>
<script src="https://files.bpcontent.cloud/2025/10/31/00/20251031000555-2CX1VKR7.js" defer></script>